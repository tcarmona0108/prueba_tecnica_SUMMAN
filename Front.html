<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prueba Técnica | SUMMAN — Tomás Carmona Salazar</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSV + Charts (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --brand:#A0C22D;
      --text:#0f172a;
      --muted:#475569;
      --bg:#f8fafc;
      --card:#ffffff;
      --line:#e2e8f0;
      --shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
      --radius:16px;
      --radius-sm:12px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:linear-gradient(180deg, #ffffff 0%, var(--bg) 100%);
    }

    a{color:inherit}
    .container{
      max-width:1120px;
      margin:0 auto;
      padding:24px;
    }

    /* Top bar */
    .topbar{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,0.85);
      backdrop-filter:saturate(180%) blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topbar-inner{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px;
      padding:12px 24px;
      max-width:1120px;
      margin:0 auto;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:700;
      letter-spacing:-0.02em;
    }
    .brand img{height:28px; width:auto}
    .nav{
      display:flex; align-items:center; gap:14px;
      font-size:14px;
      color:var(--muted);
    }
    .nav a{
      text-decoration:none;
      padding:8px 10px;
      border-radius:10px;
    }
    .nav a:hover{
      background:#f1f5f9;
      color:var(--text);
    }

    /* Hero */
    .hero{
      margin-top:22px;
      padding:26px;
      border-radius:var(--radius);
      background:linear-gradient(135deg, rgba(160,194,45,0.18) 0%, rgba(255,255,255,1) 48%, rgba(160,194,45,0.10) 100%);
      border:1px solid rgba(160,194,45,0.35);
      box-shadow:var(--shadow);
    }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap:18px;
      align-items:start;
    }
    .kicker{
      display:inline-flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      font-weight:600;
      color:#14532d;
      background:rgba(160,194,45,0.25);
      border:1px solid rgba(160,194,45,0.40);
      padding:6px 10px;
      border-radius:999px;
    }
    h1{
      margin:14px 0 10px 0;
      font-size:38px;
      line-height:1.1;
      letter-spacing:-0.03em;
    }
    .subtitle{
      color:var(--muted);
      font-size:15px;
      line-height:1.55;
      margin:0;
      max-width:70ch;
    }
    .hero-cards{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }

    /* Cards */
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.06);
      padding:18px;
    }
    .card h3{
      margin:0 0 8px 0;
      font-size:15px;
      letter-spacing:-0.01em;
    }
    .card p{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.55;
    }
    .pill{
      display:inline-flex; align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-size:13px;
      text-decoration:none;
    }
    .pill strong{font-weight:700}
    .pill .dot{
      width:10px; height:10px; border-radius:50%;
      background:var(--brand);
      display:inline-block;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      background:var(--brand);
      color:#0b1220;
      border:none;
      font-weight:700;
      padding:10px 12px;
      border-radius:12px;
      text-decoration:none;
      cursor:pointer;
    }
    .btn:hover{filter:brightness(0.97)}
    .btn.secondary{
      background:#fff;
      border:1px solid var(--line);
      color:var(--text);
      font-weight:600;
    }

    /* Sections */
    section{margin-top:22px}
    .section-title{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:16px;
      margin:22px 0 10px 0;
    }
    .section-title h2{
      margin:0;
      font-size:20px;
      letter-spacing:-0.02em;
    }
    .section-title span{
      color:var(--muted);
      font-size:13px;
    }

    /* Two-column layout */
    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .hero-grid{grid-template-columns:1fr}
      .grid-2{grid-template-columns:1fr}
      .nav{display:none}
    }

    /* Power BI responsive */
    .embed{
      border-radius:var(--radius);
      overflow:hidden;
      border:1px solid var(--line);
      background:#fff;
      box-shadow:var(--shadow);
    }
    .embed .ratio{
      position:relative;
      width:100%;
      padding-top:62.25%; /* 600x373.5 */
    }
    .embed iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
    }

    /* Upload / Dropzone */
    .dropzone{
      border:2px dashed rgba(160,194,45,0.55);
      background:rgba(160,194,45,0.08);
      border-radius:var(--radius);
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .dropzone strong{display:block; margin-bottom:4px}
    .dropzone small{color:var(--muted)}
    .dropzone input{display:none}
    .drop-actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

    /* Tables */
    .table-wrap{
      overflow:auto;
      border-radius:var(--radius-sm);
      border:1px solid var(--line);
      background:#fff;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      min-width: 720px;
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      text-align:left;
      white-space:nowrap;
    }
    th{
      background:#f8fafc;
      color:#0f172a;
      font-weight:700;
      position:sticky;
      top:0;
    }

    /* Charts */
    .chart-card{
      padding:14px;
    }
    .chart-holder{
      height:320px;
    }

    /* Footer */
    footer{
      margin:26px 0 8px;
      color:var(--muted);
      font-size:12px;
      text-align:center;
    }

    .hint{
      color:var(--muted);
      font-size:12px;
      margin-top:8px;
      line-height:1.45;
    }

    .callout{
      border-left:4px solid var(--brand);
      padding:12px 12px;
      background:#fff;
      border-radius:12px;
      border:1px solid var(--line);
    }

    code.inline{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background:#f1f5f9;
      padding:2px 6px;
      border-radius:8px;
      font-size:12px;
    }
  </style>
</head>

<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <img src="./assets/summan_logo.png" alt="SUMMAN" onerror="this.style.display='none'">
        <span>Prueba Técnica — Tomás Carmona Salazar</span>
      </div>
      <nav class="nav">
        <a href="#overview">Resumen</a>
        <a href="#punto1">Punto 1</a>
        <a href="#punto2">Punto 2</a>
        <a href="#artifacts">Artifacts</a>
      </nav>
    </div>
  </div>

  <div class="container" id="overview">
    <!-- Hero -->
    <div class="hero">
      <div class="hero-grid">
        <div>
          <span class="kicker">Entrega Técnica · Analítica & ML</span>
          <h1>Entrega organizada: EDA, Segmentación y Machine Learning</h1>
          <p class="subtitle">
            Esta página centraliza los entregables del ejercicio: un reporte interactivo en Power BI (EDA),
            el repositorio con código y notebooks, y los resultados de segmentación de clientes (2.1) y
            predicción de devoluciones (2.2).
          </p>

          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="pill" href="#punto1"><span class="dot"></span><strong>Punto 1</strong> · EDA en Power BI</a>
            <a class="pill" href="#punto2"><span class="dot"></span><strong>Punto 2</strong> · Segmentación + ML</a>
            <a class="pill" href="https://github.com/tcarmona0108/prueba_tecnica_SUMMAN" target="_blank" rel="noreferrer">
              <span class="dot"></span><strong>Repositorio</strong> · GitHub
            </a>
          </div>
        </div>

        <div class="hero-cards">
          <div class="card">
            <h3>Entregables incluidos</h3>
            <p>
              • Power BI (EDA) embebido<br>
              • PPT (Punto 2) descargable<br>
              • CSVs de resultados (segmentación y ML)<br>
              • Visualización automática (tablas y gráficos)
            </p>
          </div>

          <div class="card">
            <h3>Cómo usar esta página</h3>
            <p>
              Si los archivos están en <code class="inline">/artifacts</code>, se renderizan solos.
              También puedes arrastrar y soltar CSVs en la sección “Artifacts”.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Punto 1 -->
    <section id="punto1">
      <div class="section-title">
        <h2>Punto 1 — Análisis Exploratorio (Power BI)</h2>
        <span>Reporte interactivo embebido</span>
      </div>

      <div class="embed">
        <div class="ratio">
          <!-- Tu embed exacto -->
          <iframe title="EDA_PruebaTecnica_SUMMAN"
            src="https://app.powerbi.com/view?r=eyJrIjoiODFmNTg2ZjMtYjMwYi00NGU4LThlYzMtNDFiZWVkY2Q3MWY1IiwidCI6IjU3N2ZjMWQ4LTA5MjItNDU4ZS04N2JmLWVjNGY0NTVlYjYwMCIsImMiOjR9"
            allowfullscreen="true">
          </iframe>
        </div>
      </div>

      <p class="hint">
        Nota: el archivo <code class="inline">.pbix</code> no se visualiza en navegador; la forma correcta de “mostrarlo” es el embed del reporte publicado (como arriba).
      </p>
    </section>

    <!-- Punto 2 -->
    <section id="punto2">
      <div class="section-title">
        <h2>Punto 2 — Segmentación (2.1) y Machine Learning (2.2)</h2>
        <span>Resumen ejecutivo + acceso a código y resultados</span>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3>2.1 Segmentación de clientes</h3>
          <p>
            Customer 360 (1 fila por cliente) integrando valor, RFM, pricing (descuentos),
            operación (lead time, devoluciones) y mix. Clustering con K-Means sobre variables numéricas,
            con escalado robusto, transformaciones y validación interna (Silhouette/DBI/CH) + estabilidad (ARI).
          </p>
          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn secondary" href="#segmentation">Ver resultados 2.1</a>
          </div>
        </div>

        <div class="card">
          <h3>2.2 ML — Predicción de devoluciones</h3>
          <p>
            Modelo supervisado a nivel orden (Order_ID) para priorizar órdenes con mayor riesgo de devolución.
            Validación temporal, feature engineering sin leakage (histórico con shift) y evaluación con lift por deciles.
          </p>
          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn secondary" href="#ml">Ver resultados 2.2</a>
            <a class="btn" href="https://github.com/tcarmona0108/prueba_tecnica_SUMMAN" target="_blank" rel="noreferrer">
              Abrir repositorio
            </a>
          </div>
        </div>
      </div>

      <div class="callout" style="margin-top:14px;">
        <strong>Presentación Punto 2 (descargable)</strong><br>
        <span style="color:var(--muted); font-size:13px;">
          Si publicas el PPTX en <code class="inline">/artifacts</code>, quedará disponible aquí.
        </span>
        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn" href="./artifacts/Punto2_SUMMAN_Tomas_Carmona.pptx" download>Descargar PPT Punto 2</a>
          <a class="btn secondary" href="#artifacts">Ver artifacts</a>
        </div>
      </div>
    </section>

    <!-- Artifacts -->
    <section id="artifacts">
      <div class="section-title">
        <h2>Artifacts — Archivos y visualización</h2>
        <span>Arrastra CSVs para renderizar tablas y gráficos</span>
      </div>

      <div class="dropzone" id="dropzone">
        <div>
          <strong>Subir artifacts (CSV) para visualizar</strong>
          <small>Soportado: cluster_profile_summary.csv, model_selection_results.csv, lift_deciles_hgb.csv, order_return_predictions.csv</small>
        </div>
        <div class="drop-actions">
          <label class="btn secondary" for="fileInput">Seleccionar archivos</label>
          <input id="fileInput" type="file" multiple accept=".csv" />
          <button class="btn" id="loadDefaultsBtn" type="button">Cargar desde /artifacts</button>
        </div>
      </div>

      <p class="hint">
        Para publicación fija, sube los archivos a la carpeta <code class="inline">/artifacts</code>.
        Para demo local, puedes arrastrarlos aquí y se visualizarán en el navegador (no se guardan).
      </p>

      <!-- 2.1 Segmentation outputs -->
      <section id="segmentation">
        <div class="section-title">
          <h2>2.1 — Resultados de segmentación</h2>
          <span>Tabla ejecutiva por cluster + selección de modelo</span>
        </div>

        <div class="grid-2">
          <div class="card chart-card">
            <h3>Perfil por cluster</h3>
            <p>Se llena con <code class="inline">cluster_profile_summary.csv</code>.</p>
            <div class="table-wrap" style="margin-top:10px;">
              <table id="clusterProfileTable">
                <thead><tr><th>Esperando archivo...</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div class="card chart-card">
            <h3>Selección de modelo (tuning)</h3>
            <p>Se llena con <code class="inline">model_selection_results.csv</code>.</p>
            <div class="table-wrap" style="margin-top:10px;">
              <table id="modelSelectionTable">
                <thead><tr><th>Esperando archivo...</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- 2.2 ML outputs -->
      <section id="ml">
        <div class="section-title">
          <h2>2.2 — Resultados ML (devoluciones)</h2>
          <span>Lift por deciles + métricas operativas Top 10%</span>
        </div>

        <div class="grid-2">
          <div class="card chart-card">
            <h3>Lift por deciles</h3>
            <p>Se llena con <code class="inline">lift_deciles_hgb.csv</code>.</p>
            <div class="chart-holder">
              <canvas id="liftChart"></canvas>
            </div>
          </div>

          <div class="card">
            <h3>Métricas operativas (Top 10%)</h3>
            <p>Se calcula desde <code class="inline">order_return_predictions.csv</code> (y_true + probabilidad).</p>
            <div style="margin-top:12px;" id="mlMetrics">
              <p style="color:var(--muted); margin:0;">Esperando archivo...</p>
            </div>
          </div>
        </div>

        <div class="card chart-card" style="margin-top:14px;">
          <h3>Tabla de scoring por orden (extracto)</h3>
          <p>Se llena con <code class="inline">order_return_predictions.csv</code>.</p>
          <div class="table-wrap" style="margin-top:10px;">
            <table id="orderPredTable">
              <thead><tr><th>Esperando archivo...</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <div class="card" style="margin-top:14px;">
        <h3>Descargas directas</h3>
        <p>Si los archivos están publicados en <code class="inline">/artifacts</code>, estos links funcionarán:</p>
        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <a class="pill" href="./artifacts/cluster_profile_summary.csv" download><span class="dot"></span><strong>cluster_profile_summary.csv</strong></a>
          <a class="pill" href="./artifacts/customer_segmentation_output.csv" download><span class="dot"></span><strong>customer_segmentation_output.csv</strong></a>
          <a class="pill" href="./artifacts/model_selection_results.csv" download><span class="dot"></span><strong>model_selection_results.csv</strong></a>
          <a class="pill" href="./artifacts/lift_deciles_hgb.csv" download><span class="dot"></span><strong>lift_deciles_hgb.csv</strong></a>
          <a class="pill" href="./artifacts/order_return_predictions.csv" download><span class="dot"></span><strong>order_return_predictions.csv</strong></a>
          <a class="pill" href="./artifacts/Punto2_SUMMAN_Tomas_Carmona.pptx" download><span class="dot"></span><strong>Punto2_SUMMAN_Tomas_Carmona.pptx</strong></a>
        </div>
      </div>
    </section>

    <footer>
      SUMMAN · Prueba Técnica — Página de entregables · Tomás Carmona Salazar
    </footer>
  </div>

  <script>
    // -----------------------------
    // Utilities
    // -----------------------------
    const filesMap = new Map();
    const BRAND = "#A0C22D";

    function parseCSV(fileOrUrl, onDone){
      if(typeof fileOrUrl === "string"){
        Papa.parse(fileOrUrl, {
          download:true,
          header:true,
          skipEmptyLines:true,
          dynamicTyping:false,
          complete: (res) => onDone(res.data),
          error: () => onDone(null)
        });
      } else {
        Papa.parse(fileOrUrl, {
          header:true,
          skipEmptyLines:true,
          dynamicTyping:false,
          complete: (res) => onDone(res.data),
          error: () => onDone(null)
        });
      }
    }

    function renderTable(tableEl, rows, maxRows=20){
      if(!rows || !rows.length){
        tableEl.innerHTML = "<thead><tr><th>No hay datos</th></tr></thead><tbody></tbody>";
        return;
      }
      const cols = Object.keys(rows[0]);
      const head = `<thead><tr>${cols.map(c=>`<th>${escapeHtml(c)}</th>`).join("")}</tr></thead>`;
      const bodyRows = rows.slice(0, maxRows).map(r=>{
        return `<tr>${cols.map(c=>`<td>${escapeHtml(r[c])}</td>`).join("")}</tr>`;
      }).join("");
      tableEl.innerHTML = head + `<tbody>${bodyRows}</tbody>`;
    }

    function escapeHtml(v){
      if(v === null || v === undefined) return "";
      return String(v)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function toNum(x){
      const n = Number(String(x).replace(",", "."));
      return Number.isFinite(n) ? n : NaN;
    }

    // -----------------------------
    // 2.2 Lift chart
    // -----------------------------
    let liftChart = null;
    function renderLiftChart(rows){
      if(!rows || !rows.length) return;

      // expects: decile, return_rate, cum_return_share
      const sorted = [...rows].sort((a,b)=>toNum(a.decile)-toNum(b.decile));
      const labels = sorted.map(r => String(r.decile));
      const returnRate = sorted.map(r => toNum(r.return_rate));
      const cumShare = sorted.map(r => toNum(r.cum_return_share));

      const ctx = document.getElementById("liftChart");
      if(liftChart) liftChart.destroy();

      liftChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              label: "Return rate (por decil)",
              data: returnRate,
              borderWidth: 0,
              backgroundColor: "rgba(160,194,45,0.55)"
            },
            {
              label: "Captura acumulada (cum_return_share)",
              data: cumShare,
              type: "line",
              yAxisID: "y1",
              borderColor: BRAND,
              backgroundColor: BRAND,
              tension: 0.25,
              pointRadius: 3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: "bottom" }
          },
          scales: {
            y: {
              beginAtZero:true,
              ticks: { callback: v => (v*100).toFixed(0) + "%" }
            },
            y1: {
              beginAtZero:true,
              position: "right",
              grid: { drawOnChartArea:false },
              ticks: { callback: v => (v*100).toFixed(0) + "%" }
            }
          }
        }
      });
    }

    // -----------------------------
    // 2.2 Metrics from order_return_predictions.csv
    // -----------------------------
    function computeTopPctMetrics(rows, topPct=0.10){
      // expects: y_true_returned, p_return_hgb OR similar
      if(!rows || !rows.length) return null;

      const yKey = Object.keys(rows[0]).find(k => k.toLowerCase().includes("y_true"));
      const pKey = Object.keys(rows[0]).find(k => k.toLowerCase().includes("p_return"));

      if(!yKey || !pKey) return null;

      const clean = rows
        .map(r => ({ y: toNum(r[yKey]), p: toNum(r[pKey]) }))
        .filter(r => Number.isFinite(r.y) && Number.isFinite(r.p));

      if(clean.length === 0) return null;

      const sorted = [...clean].sort((a,b)=>b.p-a.p);
      const nTop = Math.max(1, Math.floor(sorted.length * topPct));
      const top = sorted.slice(0, nTop);

      const totalPos = clean.reduce((acc,r)=>acc+(r.y===1?1:0), 0);
      const tp = top.reduce((acc,r)=>acc+(r.y===1?1:0), 0);
      const fp = nTop - tp;
      const fn = totalPos - tp;

      const precision = tp / Math.max(1, (tp+fp));
      const recall = tp / Math.max(1, (tp+fn));
      const baseRate = totalPos / clean.length;
      const topRate = tp / nTop;
      const lift = topRate / Math.max(1e-9, baseRate);

      return { n: clean.length, nTop, totalPos, tp, fp, fn, precision, recall, baseRate, topRate, lift };
    }

    function renderMlMetrics(rows){
      const box = document.getElementById("mlMetrics");
      const m = computeTopPctMetrics(rows, 0.10);
      if(!m){
        box.innerHTML = `<p style="color:var(--muted); margin:0;">No fue posible calcular métricas. Verifica columnas y_true y probabilidad.</p>`;
        return;
      }

      box.innerHTML = `
        <div class="table-wrap" style="min-width:unset;">
          <table style="min-width:unset;">
            <thead>
              <tr>
                <th>Métrica</th><th>Valor</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>N (test)</td><td>${m.n}</td></tr>
              <tr><td>Top 10% (n)</td><td>${m.nTop}</td></tr>
              <tr><td>Base rate (devoluciones)</td><td>${(m.baseRate*100).toFixed(2)}%</td></tr>
              <tr><td>Return rate en Top 10%</td><td>${(m.topRate*100).toFixed(2)}%</td></tr>
              <tr><td>Lift (Top 10%)</td><td>${m.lift.toFixed(2)}×</td></tr>
              <tr><td>Precision (Top 10%)</td><td>${(m.precision*100).toFixed(2)}%</td></tr>
              <tr><td>Recall (Top 10%)</td><td>${(m.recall*100).toFixed(2)}%</td></tr>
              <tr><td>TP / FP / FN</td><td>${m.tp} / ${m.fp} / ${m.fn}</td></tr>
            </tbody>
          </table>
        </div>
      `;
    }

    // -----------------------------
    // Router for files
    // -----------------------------
    function handleDataset(filename, rows){
      const name = filename.toLowerCase();

      if(name.includes("cluster_profile_summary")){
        renderTable(document.getElementById("clusterProfileTable"), rows, 50);
        return;
      }
      if(name.includes("model_selection_results")){
        renderTable(document.getElementById("modelSelectionTable"), rows, 20);
        return;
      }
      if(name.includes("lift_deciles")){
        renderLiftChart(rows);
        return;
      }
      if(name.includes("order_return_predictions")){
        renderMlMetrics(rows);
        renderTable(document.getElementById("orderPredTable"), rows, 25);
        return;
      }

      // fallback: show nothing (you can extend)
      console.log("CSV cargado pero no reconocido:", filename);
    }

    // -----------------------------
    // Load defaults from /artifacts
    // -----------------------------
    function loadDefaults(){
      const defaults = [
        "./artifacts/cluster_profile_summary.csv",
        "./artifacts/model_selection_results.csv",
        "./artifacts/lift_deciles_hgb.csv",
        "./artifacts/order_return_predictions.csv"
      ];

      defaults.forEach(url => {
        parseCSV(url, (rows)=>{
          if(!rows) return;
          const filename = url.split("/").pop();
          handleDataset(filename, rows);
        });
      });
    }

    // -----------------------------
    // Drag & drop + input
    // -----------------------------
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const loadDefaultsBtn = document.getElementById("loadDefaultsBtn");

    loadDefaultsBtn.addEventListener("click", loadDefaults);

    function processFiles(fileList){
      [...fileList].forEach(f=>{
        if(!f.name.toLowerCase().endsWith(".csv")) return;
        parseCSV(f, (rows)=>{
          filesMap.set(f.name, rows);
          handleDataset(f.name, rows);
        });
      });
    }

    fileInput.addEventListener("change", (e)=>{
      if(e.target.files) processFiles(e.target.files);
    });

    dropzone.addEventListener("dragover", (e)=>{
      e.preventDefault();
      dropzone.style.background = "rgba(160,194,45,0.14)";
    });

    dropzone.addEventListener("dragleave", ()=>{
      dropzone.style.background = "rgba(160,194,45,0.08)";
    });

    dropzone.addEventListener("drop", (e)=>{
      e.preventDefault();
      dropzone.style.background = "rgba(160,194,45,0.08)";
      if(e.dataTransfer?.files) processFiles(e.dataTransfer.files);
    });

    // Auto-load defaults if present
    window.addEventListener("DOMContentLoaded", ()=>{
      loadDefaults();
    });
  </script>
</body>
</html>
